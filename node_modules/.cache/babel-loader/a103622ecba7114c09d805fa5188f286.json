{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\PC\\\\Desktop\\\\react-project\\\\src\\\\containers\\\\Role\\\\index.jsx\",\n    _dec,\n    _class,\n    _temp;\n\nimport React, { PureComponent } from 'react';\nimport { reqRoles\n/* ,reqAddRole,reqUpdateRole */\n} from '../../api/index';\nimport dayjs from 'dayjs'; // import ADDForm from './add-form'\n// import AuthForm from './auth-form'\n\nimport { connect } from 'react-redux'; // 角色路由\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet Role = (_dec = connect(state => ({}), {}), _dec(_class = (_temp = class Role extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      roles: [],\n      //用来存放各种角色的数组\n      role: {},\n      //选中的role\n      isShowAdd: false,\n      //是否显示添加界面\n      isShowAuth: false //是否显示设置权限界面\n\n    };\n\n    this.getRoles = async () => {\n      const result = await reqRoles();\n\n      if (result.status === 0) {\n        const roles = result.data;\n        this.setState({\n          roles\n        });\n      }\n    };\n\n    this.handleOk = () => {\n      console.log(\"哈哈\");\n      /*   //进行表单验证\r\n      //   console.log(this.form);\r\n      this.form.validateFields()\r\n      .then(async (values)=>{\r\n          //隐藏确认框\r\n          this.setState({isShowAdd:false})\r\n          //收集输入数据\r\n          const {roleName} = values\r\n          this.form.resetFields()\r\n          //发请求添加\r\n          const result = await reqAddRole(roleName)\r\n          if (result.status===0) {\r\n          //   this.getRoles()\r\n          // 新产生的角色\r\n          const role = result.data\r\n          // 更新roles状态  更新后的数据和之前的状态数据有关\r\n          this.setState(state=>({\r\n            roles: [...state.roles,role]\r\n          }))\r\n          } else {\r\n            message.error('添加角色失败')\r\n          }\r\n        }\r\n      )\r\n      .catch(errorInfo => {\r\n          alert('出错',errorInfo)\r\n        }); */\n    };\n\n    this.handleCancel = () => {\n      /* this.form.resetFields()\r\n      this.setState({isShowAdd:false}) */\n    };\n\n    this.updateRole = async () => {\n      /*  // 隐藏确认框\r\n       this.setState({\r\n         isShowAuth: false\r\n       })\r\n       const role = this.state.role\r\n       // 得到最新的menus\r\n       const menus = this.auth.current.getMenus()\r\n       role.menus = menus\r\n       role.auth_time = Date.now()\r\n       role.auth_name = memoryUtils.user.username\r\n            // 请求更新\r\n       const result = await reqUpdateRole(role)\r\n       if (result.status === 0) {\r\n         // 如果当前更新的是自己角色的权限 需要强制退出\r\n         if (role._id === memoryUtils.user.role_id) {\r\n           // 清空本地存储\r\n           memoryUtils.user = {}\r\n           storageUtils.removeUser()\r\n           this.props.history.replace('/login')\r\n           message.success('用户权限已更新,请重新登录!')\r\n         } else {\r\n           message.success('设置权限成功')\r\n           // 获取显示列表的两种方式\r\n           // this.getRoles()\r\n           this.setState({\r\n             roles: [...this.state.roles]\r\n           })\r\n         }\r\n              \r\n       } */\n    };\n\n    this.handleCancelUpdate = () => {\n      this.setState({\n        isShowAuth: false\n      }); // this.form.resetFields()\n    };\n\n    this.auth = /*#__PURE__*/React.createRef();\n  }\n\n  componentDidMount() {\n    //发送请求获取角色列表数据\n    this.getRoles();\n  } // 获取角色的列表数据\n\n\n  render() {\n    const {\n      roles,\n      role,\n      isShowAdd,\n      isShowAuth\n    } = this.state;\n    const columns = [{\n      title: '角色名称',\n      dataIndex: 'name',\n      key: 'name'\n    }, {\n      title: '创建时间',\n      dataIndex: 'create_time',\n      key: 'create_time',\n      render: time => dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss')\n    }, {\n      title: '授权时间',\n      dataIndex: 'auth_time',\n      key: 'auth_time',\n      render: time => time ? dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss') : ''\n    }, {\n      title: '授权人',\n      dataIndex: 'auth_name',\n      key: 'auth_name'\n    }, {\n      title: '操作',\n      key: 'option',\n      render: item => /*#__PURE__*/_jsxDEV(_Button, {\n        type: \"link\",\n        onClick: () => {\n          this.showAuth(item._id);\n        },\n        children: \"\\u8BBE\\u7F6E\\u6743\\u9650\"\n      }, \"123\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 35\n      }, this)\n    }];\n\n    const title = /*#__PURE__*/_jsxDEV(\"span\", {\n      children: [/*#__PURE__*/_jsxDEV(_Button, {\n        onClick: () => {\n          this.setState({\n            isShowAdd: true\n          });\n        },\n        type: \"primary\",\n        children: \"\\u521B\\u5EFA\\u89D2\\u8272\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this), \" \\xA0 \\xA0\", /*#__PURE__*/_jsxDEV(_Button, {\n        type: \"primary\"\n        /* disabled={!role._id} */\n        ,\n        onClick: () => {\n          this.setState({\n            isShowAuth: true\n          });\n        },\n        children: \"\\u8BBE\\u7F6E\\u89D2\\u8272\\u6743\\u9650\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }, this);\n\n    return /*#__PURE__*/_jsxDEV(_Card, {\n      title: title,\n      children: [/*#__PURE__*/_jsxDEV(_Table, {\n        bordered: true // rowKey='_id'\n        ,\n        dataSource: roles,\n        columns: columns\n        /* pagination={{ defaultPageSize: 3 }} */\n        ,\n        rowSelection: {\n          type: 'radio'\n          /* selectedRowKeys:[role._id], */\n          // 当选择某个radio的回调\n          //   onSelect: (role)=>{this.setState({role})}\n\n        }\n        /* onRow={this.onRow} */\n\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u6DFB\\u52A0\\u89D2\\u8272\",\n        visible: isShowAdd,\n        onOk: this.handleOk,\n        onCancel: this.handleCancel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u8BBE\\u7F6E\\u89D2\\u8272\\u6743\\u9650\",\n        visible: isShowAuth,\n        onOk: this.updateRole,\n        onCancel: this.handleCancelUpdate,\n        children:\n        /* <AuthForm /* ref={this.auth} role={role} */\n        /> */\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 13\n    }, this);\n  }\n\n}, _temp)) || _class);\nexport default Role;","map":{"version":3,"sources":["C:/Users/PC/Desktop/react-project/src/containers/Role/index.jsx"],"names":["React","PureComponent","reqRoles","dayjs","connect","Role","state","constructor","props","roles","role","isShowAdd","isShowAuth","getRoles","result","status","data","setState","handleOk","console","log","handleCancel","updateRole","handleCancelUpdate","auth","createRef","componentDidMount","render","columns","title","dataIndex","key","time","format","item","showAuth","_id","type"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react'\r\nimport { Card, Button, Table, Modal, /* message */ } from 'antd'\r\nimport { reqRoles/* ,reqAddRole,reqUpdateRole */ } from '../../api/index'\r\nimport dayjs from 'dayjs'\r\n// import ADDForm from './add-form'\r\n// import AuthForm from './auth-form'\r\nimport { connect } from 'react-redux'\r\n\r\n// 角色路由\r\n@connect(\r\n    state => ({}),\r\n    {}\r\n)\r\nclass Role extends PureComponent {\r\n    state = {\r\n        roles: [],  //用来存放各种角色的数组\r\n        role: {},  //选中的role\r\n        isShowAdd: false,  //是否显示添加界面\r\n        isShowAuth: false, //是否显示设置权限界面\r\n    }\r\n    constructor(props) {\r\n        super(props)\r\n        this.auth = React.createRef()\r\n    }\r\n    componentDidMount() {\r\n        //发送请求获取角色列表数据\r\n        this.getRoles()\r\n    }\r\n    // 获取角色的列表数据\r\n    getRoles = async () => {\r\n        const result = await reqRoles()\r\n        if (result.status === 0) {\r\n            const roles = result.data\r\n            this.setState({ roles })\r\n        }\r\n    }\r\n\r\n    /* onRow = (role) => {\r\n        return {\r\n            onClick: event => {\r\n                this.setState({ role })\r\n            }\r\n        }\r\n    } */\r\n\r\n    // 添加角色成功的回调函数\r\n    handleOk = () => {\r\n        console.log(\"哈哈\");\r\n        /*   //进行表单验证\r\n        //   console.log(this.form);\r\n        this.form.validateFields()\r\n        .then(async (values)=>{\r\n            //隐藏确认框\r\n            this.setState({isShowAdd:false})\r\n            //收集输入数据\r\n            const {roleName} = values\r\n            this.form.resetFields()\r\n            //发请求添加\r\n            const result = await reqAddRole(roleName)\r\n            if (result.status===0) {\r\n            //   this.getRoles()\r\n            // 新产生的角色\r\n            const role = result.data\r\n            // 更新roles状态  更新后的数据和之前的状态数据有关\r\n            this.setState(state=>({\r\n              roles: [...state.roles,role]\r\n            }))\r\n            } else {\r\n              message.error('添加角色失败')\r\n            }\r\n          }\r\n        )\r\n        .catch(errorInfo => {\r\n            alert('出错',errorInfo)\r\n          }); */\r\n    }\r\n\r\n    //取消添加角色的回调\r\n    handleCancel = () => {\r\n        /* this.form.resetFields()\r\n        this.setState({isShowAdd:false}) */\r\n    }\r\n\r\n    // 更新角色的回调函数\r\n    updateRole = async () => {\r\n        /*  // 隐藏确认框\r\n         this.setState({\r\n           isShowAuth: false\r\n         })\r\n         const role = this.state.role\r\n         // 得到最新的menus\r\n         const menus = this.auth.current.getMenus()\r\n         role.menus = menus\r\n         role.auth_time = Date.now()\r\n         role.auth_name = memoryUtils.user.username\r\n   \r\n         // 请求更新\r\n         const result = await reqUpdateRole(role)\r\n         if (result.status === 0) {\r\n           // 如果当前更新的是自己角色的权限 需要强制退出\r\n           if (role._id === memoryUtils.user.role_id) {\r\n             // 清空本地存储\r\n             memoryUtils.user = {}\r\n             storageUtils.removeUser()\r\n             this.props.history.replace('/login')\r\n             message.success('用户权限已更新,请重新登录!')\r\n           } else {\r\n             message.success('设置权限成功')\r\n             // 获取显示列表的两种方式\r\n             // this.getRoles()\r\n             this.setState({\r\n               roles: [...this.state.roles]\r\n             })\r\n           }\r\n   \r\n           \r\n         } */\r\n    }\r\n\r\n    // 取消更新角色的回调\r\n    handleCancelUpdate = () => {\r\n        this.setState({ isShowAuth: false })\r\n        // this.form.resetFields()\r\n    }\r\n\r\n    render() {\r\n        const { roles, role, isShowAdd, isShowAuth } = this.state\r\n        const columns = [\r\n            {\r\n                title: '角色名称',\r\n                dataIndex: 'name',\r\n                key: 'name',\r\n            },\r\n            {\r\n                title: '创建时间',\r\n                dataIndex: 'create_time',\r\n                key: 'create_time',\r\n                render: (time) => dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss')\r\n            },\r\n            {\r\n                title: '授权时间',\r\n                dataIndex: 'auth_time',\r\n                key: 'auth_time',\r\n                render: (time) => time ? dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss') : ''\r\n            },\r\n            {\r\n                title: '授权人',\r\n                dataIndex: 'auth_name',\r\n                key: 'auth_name',\r\n            },\r\n            {\r\n                title: '操作',\r\n                key: 'option',\r\n                render: (item) => <Button key=\"123\" type='link' onClick={() => { this.showAuth(item._id) }}>设置权限</Button>\r\n            }\r\n        ];\r\n        const title = (\r\n            <span>\r\n                <Button onClick={()=>{this.setState({isShowAdd: true})}} type='primary'>创建角色</Button> &nbsp; &nbsp;\r\n                <Button type='primary' /* disabled={!role._id} */\r\n             onClick={()=>{this.setState({isShowAuth: true})}} >设置角色权限</Button>\r\n            </span>\r\n        )\r\n        return (\r\n            <Card title={title}>\r\n                <Table\r\n                    bordered\r\n                    // rowKey='_id'\r\n                    dataSource={roles}\r\n                    columns={columns}\r\n                    /* pagination={{ defaultPageSize: 3 }} */\r\n                    rowSelection={{\r\n                        type: 'radio',/* selectedRowKeys:[role._id], */\r\n                        // 当选择某个radio的回调\r\n                        //   onSelect: (role)=>{this.setState({role})}\r\n                    }}\r\n                    /* onRow={this.onRow} */ />\r\n                <Modal\r\n                    title='添加角色'\r\n                    visible={isShowAdd}\r\n                    onOk={this.handleOk}\r\n                    onCancel={this.handleCancel}\r\n                >\r\n                    {/* <ADDForm setForm={form=>this.form = form} />  */}\r\n                </Modal>\r\n                <Modal\r\n                    title='设置角色权限'\r\n                    visible={isShowAuth}\r\n                    onOk={this.updateRole}\r\n                    onCancel={this.handleCancelUpdate}\r\n                >\r\n                    {/* <AuthForm /* ref={this.auth} role={role} *//> */}\r\n                </Modal>\r\n            </Card>\r\n        )\r\n    }\r\n}\r\nexport default Role"]},"metadata":{},"sourceType":"module"}