{"ast":null,"code":"import\"antd/es/modal/style\";import _Modal from\"antd/es/modal\";import\"antd/es/upload/style\";import _Upload from\"antd/es/upload\";import\"antd/es/message/style\";import _message from\"antd/es/message\";import _regeneratorRuntime from\"C:/Users/PC/Desktop/\\u6E90\\u7801/react_Project/react-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/PC/Desktop/\\u6E90\\u7801/react_Project/react-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/PC/Desktop/\\u6E90\\u7801/react_Project/react-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/PC/Desktop/\\u6E90\\u7801/react_Project/react-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/PC/Desktop/\\u6E90\\u7801/react_Project/react-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/PC/Desktop/\\u6E90\\u7801/react_Project/react-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{PlusOutlined}from'@ant-design/icons';import{reqDeletePicture}from'../../api';import{BASE_URL}from'../../config';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function getBase64(file){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){return resolve(reader.result);};reader.onerror=function(error){return reject(error);};});}var PicturesWall=/*#__PURE__*/function(_Component){_inherits(PicturesWall,_Component);var _super=_createSuper(PicturesWall);function PicturesWall(){var _this;_classCallCheck(this,PicturesWall);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={previewVisible:false,//是否展示预览窗\n//要预览的图片的url地址\npreviewImage:'https://img2.huashi6.com/images/resource/2017/02/07/613h20011p0.jpg?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',previewTitle:'',fileList:[//收集好的所有上传完毕的图片名\n/* {\r\n        uid: '-1',\r\n        name: 'image.png',\r\n        status: 'done',//当前图片的状态：uploading\\done\\remove\r\n        url: 'https://img2.huashi6.com/images/resource/2019/01/02/72h455834p0.png?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n      }, */ /*       {\r\n              uid: '-2',\r\n              name: 'image.png',\r\n              status: 'done',\r\n              url: 'https://img2.huashi6.com/images/resource/2021/05/12/h89778896p0.jpg?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n            },\r\n            {\r\n              uid: '-3',\r\n              name: 'image.png',\r\n              status: 'done',\r\n              url: 'https://img2.huashi6.com/images/resource/2018/09/09/7h0612393p0.png?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n            },\r\n            {\r\n              uid: '-4',\r\n              name: 'image.png',\r\n              status: 'done',\r\n              url: 'https://img2.huashi6.com/images/resource/2018/09/16/70h719730p0.png?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n            },\r\n            {\r\n              uid: '-xxx',\r\n              percent: 50,\r\n              name: 'image.png',\r\n              status: 'uploading',\r\n              url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\r\n            },\r\n            {\r\n              uid: '-5',\r\n              name: 'image.png',\r\n              status: 'error',\r\n            }, */]};_this.handleCancel=function(){return _this.setState({previewVisible:false});};_this.handlePreview=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!file.url&&!file.preview)){_context.next=4;break;}_context.next=3;return getBase64(file.originFileObj);case 3:file.preview=_context.sent;case 4:_this.setState({previewImage:file.url||file.preview,previewVisible:true,previewTitle:file.name||file.url.substring(file.url.lastIndexOf('/')+1)});case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleChange=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref2){var file,fileList,result,status,msg;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:file=_ref2.file,fileList=_ref2.fileList;if(file.status==='done'){//若上传成功\n/* console.log(file.response.data.url);\r\n      console.log(file);\r\n      console.log(fileList);\r\n      console.log(fileList.length); */ // file.url = file.response.data.url\nfileList[fileList.length-1].url=file.response.data.url;fileList[fileList.length-1].name=file.response.data.name;}if(!(file.status==='removed')){_context2.next=8;break;}_context2.next=5;return reqDeletePicture(file.name);case 5:result=_context2.sent;status=result.status,msg=result.msg;if(status===0){_message.success('删除图片成功');}else{_message.error(msg);}case 8:_this.setState({fileList:fileList});case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}();_this.getImgArr=function(){var result=[];_this.state.fileList.forEach(function(item){result.push(item.name);});return result;};_this.setFileList=function(imgArr){var result=[];imgArr.forEach(function(item,index){result.push({uid:-index,name:item,url:\"\".concat(BASE_URL,\"/upload/\").concat(item)});});_this.setState({fileList:result});};return _this;}_createClass(PicturesWall,[{key:\"render\",value:// resoponse.data.url\n// thumbUrl\nfunction render(){var _this$state=this.state,previewVisible=_this$state.previewVisible,previewImage=_this$state.previewImage,fileList=_this$state.fileList,previewTitle=_this$state.previewTitle;var uploadButton=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PlusOutlined,{}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:\"Upload\"})]});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(_Upload,{//接收图片服务器地址\naction:\"/manage/img/upload\",method:\"post\",name:\"image\",listType:\"picture-card\"//照片墙的展示方式\n,fileList:fileList//图片列表，一个数组中包含着多个图片对象{uid:xxx,status:xxx,url:xxx}\n,onPreview:this.handlePreview//当点击预览按钮的回调\n,onChange:this.handleChange//图片状态改变的回调(图片上传中，图片被删除，图片成功上传)\n,children:fileList.length>=8?null:uploadButton}),/*#__PURE__*/_jsx(_Modal,{visible:previewVisible,title:previewTitle,footer:null,onCancel:this.handleCancel,children:/*#__PURE__*/_jsx(\"img\",{alt:\"example\",style:{width:'100%'},src:previewImage})})]});}}]);return PicturesWall;}(Component);export default PicturesWall;","map":{"version":3,"sources":["C:/Users/PC/Desktop/源码/react_Project/react-project/src/containers/Product/picture_wall.jsx"],"names":["React","Component","PlusOutlined","reqDeletePicture","BASE_URL","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","PicturesWall","state","previewVisible","previewImage","previewTitle","fileList","handleCancel","setState","handlePreview","url","preview","originFileObj","name","substring","lastIndexOf","handleChange","status","length","response","data","msg","success","getImgArr","forEach","item","push","setFileList","imgArr","index","uid","uploadButton","marginTop","width"],"mappings":"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","sourcesContent":["import { Upload, Modal, message } from 'antd';\r\nimport React, { Component } from 'react'\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport { reqDeletePicture } from '../../api'\r\nimport { BASE_URL } from '../../config';\r\n\r\nfunction getBase64(file) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => resolve(reader.result);\r\n    reader.onerror = error => reject(error);\r\n  });\r\n}\r\n\r\nclass PicturesWall extends Component {\r\n  state = {\r\n    previewVisible: false,//是否展示预览窗\r\n    //要预览的图片的url地址\r\n    previewImage: 'https://img2.huashi6.com/images/resource/2017/02/07/613h20011p0.jpg?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n    previewTitle: '',\r\n    fileList: [//收集好的所有上传完毕的图片名\r\n      /* {\r\n        uid: '-1',\r\n        name: 'image.png',\r\n        status: 'done',//当前图片的状态：uploading\\done\\remove\r\n        url: 'https://img2.huashi6.com/images/resource/2019/01/02/72h455834p0.png?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n      }, */\r\n      /*       {\r\n              uid: '-2',\r\n              name: 'image.png',\r\n              status: 'done',\r\n              url: 'https://img2.huashi6.com/images/resource/2021/05/12/h89778896p0.jpg?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n            },\r\n            {\r\n              uid: '-3',\r\n              name: 'image.png',\r\n              status: 'done',\r\n              url: 'https://img2.huashi6.com/images/resource/2018/09/09/7h0612393p0.png?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n            },\r\n            {\r\n              uid: '-4',\r\n              name: 'image.png',\r\n              status: 'done',\r\n              url: 'https://img2.huashi6.com/images/resource/2018/09/16/70h719730p0.png?imageView2/3/q/100/interlace/1/w/448/h/1600/format/webp',\r\n            },\r\n            {\r\n              uid: '-xxx',\r\n              percent: 50,\r\n              name: 'image.png',\r\n              status: 'uploading',\r\n              url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\r\n            },\r\n            {\r\n              uid: '-5',\r\n              name: 'image.png',\r\n              status: 'error',\r\n            }, */\r\n    ],\r\n  };\r\n  //关闭预览窗\r\n  handleCancel = () => this.setState({ previewVisible: false });\r\n  //展示预览窗\r\n  handlePreview = async file => {\r\n    //如果图片没有url也没有转换过base64，那么调用如下方法把图片转换为base64\r\n    if (!file.url && !file.preview) {\r\n      file.preview = await getBase64(file.originFileObj);\r\n    }\r\n\r\n    this.setState({\r\n      previewImage: file.url || file.preview,\r\n      previewVisible: true,\r\n      previewTitle: file.name || file.url.substring(file.url.lastIndexOf('/') + 1),\r\n    });\r\n  };\r\n\r\n  //当图片状态发生改变的回调\r\n  handleChange = async ({ file, fileList }) => {\r\n    if (file.status === 'done') {\r\n      //若上传成功\r\n      /* console.log(file.response.data.url);\r\n      console.log(file);\r\n      console.log(fileList);\r\n      console.log(fileList.length); */\r\n      // file.url = file.response.data.url\r\n      fileList[fileList.length - 1].url = file.response.data.url\r\n      fileList[fileList.length - 1].name = file.response.data.name\r\n    }\r\n    if (file.status === 'removed') {\r\n      //删除了某个文件\r\n      // console.log(file.name);\r\n      let result = await reqDeletePicture(file.name)\r\n      const { status, msg } = result\r\n      if (status === 0) {\r\n        message.success('删除图片成功')\r\n      } else {\r\n        message.error(msg)\r\n      }\r\n    }\r\n    this.setState({ fileList })\r\n  };\r\n  //从fileList中提取出所有商品对应的图片名字，构建一个数组，供新增商品使用\r\n  getImgArr = () => {\r\n    let result = []\r\n    this.state.fileList.forEach((item) => {\r\n      result.push(item.name)\r\n    })\r\n    return result\r\n  }\r\n  setFileList = (imgArr) => {\r\n    let result = [] \r\n    imgArr.forEach((item,index)=>{\r\n      result.push({uid:-index,name:item,url:`${BASE_URL}/upload/${item}`})\r\n    })\r\n    this.setState({fileList:result})\r\n  }\r\n\r\n\r\n\r\n  // resoponse.data.url\r\n  // thumbUrl\r\n  render() {\r\n    const { previewVisible, previewImage, fileList, previewTitle } = this.state;\r\n    const uploadButton = (\r\n      <div>\r\n        <PlusOutlined />\r\n        <div style={{ marginTop: 8 }}>Upload</div>\r\n      </div>\r\n    );\r\n    return (\r\n      <>\r\n        <Upload\r\n          //接收图片服务器地址\r\n          action=\"/manage/img/upload\"\r\n          method=\"post\"\r\n          name='image'\r\n          listType=\"picture-card\"//照片墙的展示方式\r\n          fileList={fileList}//图片列表，一个数组中包含着多个图片对象{uid:xxx,status:xxx,url:xxx}\r\n          onPreview={this.handlePreview}//当点击预览按钮的回调\r\n          onChange={this.handleChange}//图片状态改变的回调(图片上传中，图片被删除，图片成功上传)\r\n        >\r\n          {fileList.length >= 8 ? null : uploadButton}\r\n        </Upload>\r\n        <Modal\r\n          visible={previewVisible}\r\n          title={previewTitle}\r\n          footer={null}\r\n          onCancel={this.handleCancel}\r\n        >\r\n          <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\nexport default PicturesWall"]},"metadata":{},"sourceType":"module"}