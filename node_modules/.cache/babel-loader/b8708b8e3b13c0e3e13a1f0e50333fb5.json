{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util';\nimport RoamController from './RoamController';\nimport * as roamHelper from '../../component/helper/roamHelper';\nimport { onIrrelevantElement } from '../../component/helper/cursorHelper';\nimport * as graphic from '../../util/graphic';\nimport { enableHoverEmphasis, enableComponentHighDownFeatures, setDefaultStateProxy } from '../../util/states';\nimport geoSourceManager from '../../coord/geo/geoSourceManager';\nimport { getUID } from '../../util/component';\nimport { setLabelStyle, getLabelStatesModels, enableLayoutLayoutFeatures } from '../../label/labelStyle';\nimport { getECData } from '../../util/innerStore';\nimport { createOrUpdatePatternFromDecal } from '../../util/decal';\nimport Displayable from 'zrender/lib/graphic/Displayable';\nimport { makeInner } from '../../util/model';\n/**\n * Only these tags enable use `itemStyle` if they are named in SVG.\n * Other tags like <text> <tspan> <image> might not suitable for `itemStyle`.\n * They will not be considered to be styled until some requirements come.\n */\n\nvar OPTION_STYLE_ENABLED_TAGS = ['rect', 'circle', 'line', 'ellipse', 'polygon', 'polyline', 'path'];\nvar OPTION_STYLE_ENABLED_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS);\nvar STATE_TRIGGER_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar LABEL_HOST_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar mapLabelRaw = makeInner();\n\nfunction getFixedItemStyle(model) {\n  var itemStyle = model.getItemStyle();\n  var areaColor = model.get('areaColor'); // If user want the color not to be changed when hover,\n  // they should both set areaColor and color to be null.\n\n  if (areaColor != null) {\n    itemStyle.fill = areaColor;\n  }\n\n  return itemStyle;\n}\n\nvar MapDraw =\n/** @class */\nfunction () {\n  function MapDraw(api) {\n    var group = new graphic.Group();\n    this.uid = getUID('ec_map_draw');\n    this._controller = new RoamController(api.getZr());\n    this._controllerHost = {\n      target: group\n    };\n    this.group = group;\n    group.add(this._regionsGroup = new graphic.Group());\n    group.add(this._svgGroup = new graphic.Group());\n  }\n\n  MapDraw.prototype.draw = function (mapOrGeoModel, ecModel, api, fromView, payload) {\n    var isGeo = mapOrGeoModel.mainType === 'geo'; // Map series has data. GEO model that controlled by map series\n    // will be assigned with map data. Other GEO model has no data.\n\n    var data = mapOrGeoModel.getData && mapOrGeoModel.getData();\n    isGeo && ecModel.eachComponent({\n      mainType: 'series',\n      subType: 'map'\n    }, function (mapSeries) {\n      if (!data && mapSeries.getHostGeoModel() === mapOrGeoModel) {\n        data = mapSeries.getData();\n      }\n    });\n    var geo = mapOrGeoModel.coordinateSystem;\n    var regionsGroup = this._regionsGroup;\n    var group = this.group;\n    var transformInfo = geo.getTransformInfo();\n    var transformInfoRaw = transformInfo.raw;\n    var transformInfoRoam = transformInfo.roam; // No animation when first draw or in action\n\n    var isFirstDraw = !regionsGroup.childAt(0) || payload;\n\n    if (isFirstDraw) {\n      group.x = transformInfoRoam.x;\n      group.y = transformInfoRoam.y;\n      group.scaleX = transformInfoRoam.scaleX;\n      group.scaleY = transformInfoRoam.scaleY;\n      group.dirty();\n    } else {\n      graphic.updateProps(group, transformInfoRoam, mapOrGeoModel);\n    }\n\n    var isVisualEncodedByVisualMap = data && data.getVisual('visualMeta') && data.getVisual('visualMeta').length > 0;\n    var viewBuildCtx = {\n      api: api,\n      geo: geo,\n      mapOrGeoModel: mapOrGeoModel,\n      data: data,\n      isVisualEncodedByVisualMap: isVisualEncodedByVisualMap,\n      isGeo: isGeo,\n      transformInfoRaw: transformInfoRaw\n    };\n\n    if (geo.resourceType === 'geoJSON') {\n      this._buildGeoJSON(viewBuildCtx);\n    } else if (geo.resourceType === 'geoSVG') {\n      this._buildSVG(viewBuildCtx);\n    }\n\n    this._updateController(mapOrGeoModel, ecModel, api);\n\n    this._updateMapSelectHandler(mapOrGeoModel, regionsGroup, api, fromView);\n  };\n\n  MapDraw.prototype._buildGeoJSON = function (viewBuildCtx) {\n    var nameMap = this._regionsGroupByName = zrUtil.createHashMap();\n    var regionsGroup = this._regionsGroup;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n    var data = viewBuildCtx.data;\n\n    var transformPoint = function (point) {\n      return [point[0] * transformInfoRaw.scaleX + transformInfoRaw.x, point[1] * transformInfoRaw.scaleY + transformInfoRaw.y];\n    };\n\n    regionsGroup.removeAll(); // Only when the resource is GeoJSON, there is `geo.regions`.\n\n    zrUtil.each(viewBuildCtx.geo.regions, function (region) {\n      var regionName = region.name;\n      var regionModel = mapOrGeoModel.getRegionModel(regionName);\n      var dataIdx = data ? data.indexOfName(regionName) : null; // Consider in GeoJson properties.name may be duplicated, for example,\n      // there is multiple region named \"United Kindom\" or \"France\" (so many\n      // colonies). And it is not appropriate to merge them in geo, which\n      // will make them share the same label and bring trouble in label\n      // location calculation.\n\n      var regionGroup = nameMap.get(regionName);\n      var hasRegionGroup = !!regionGroup;\n\n      if (!hasRegionGroup) {\n        regionGroup = nameMap.set(regionName, new graphic.Group());\n        regionsGroup.add(regionGroup);\n      }\n\n      var compoundPath = new graphic.CompoundPath({\n        segmentIgnoreThreshold: 1,\n        shape: {\n          paths: []\n        }\n      });\n      regionGroup.add(compoundPath);\n\n      if (!hasRegionGroup) {\n        // ensure children have been added to group before calling resetEventTriggerForRegion\n        resetEventTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel, dataIdx);\n        resetTooltipForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n        resetStateTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n      }\n\n      zrUtil.each(region.geometries, function (geometry) {\n        if (geometry.type !== 'polygon') {\n          return;\n        }\n\n        var points = [];\n\n        for (var i = 0; i < geometry.exterior.length; ++i) {\n          points.push(transformPoint(geometry.exterior[i]));\n        }\n\n        compoundPath.shape.paths.push(new graphic.Polygon({\n          segmentIgnoreThreshold: 1,\n          shape: {\n            points: points\n          }\n        }));\n\n        for (var i = 0; i < (geometry.interiors ? geometry.interiors.length : 0); ++i) {\n          var interior = geometry.interiors[i];\n          var points_1 = [];\n\n          for (var j = 0; j < interior.length; ++j) {\n            points_1.push(transformPoint(interior[j]));\n          }\n\n          compoundPath.shape.paths.push(new graphic.Polygon({\n            segmentIgnoreThreshold: 1,\n            shape: {\n              points: points_1\n            }\n          }));\n        }\n      });\n      applyOptionStyleForRegion(viewBuildCtx, compoundPath, dataIdx, regionModel);\n\n      if (compoundPath instanceof Displayable) {\n        compoundPath.culling = true;\n      }\n\n      var centerPt = transformPoint(region.getCenter());\n      resetLabelForRegion(viewBuildCtx, compoundPath, regionName, regionModel, mapOrGeoModel, dataIdx, centerPt);\n    }, this);\n  };\n\n  MapDraw.prototype._buildSVG = function (viewBuildCtx) {\n    var mapName = viewBuildCtx.geo.map;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    this._svgGroup.x = transformInfoRaw.x;\n    this._svgGroup.y = transformInfoRaw.y;\n    this._svgGroup.scaleX = transformInfoRaw.scaleX;\n    this._svgGroup.scaleY = transformInfoRaw.scaleY;\n\n    if (this._svgResourceChanged(mapName)) {\n      this._freeSVG();\n\n      this._useSVG(mapName);\n    }\n\n    var svgDispatcherMap = this._svgDispatcherMap = zrUtil.createHashMap();\n    var focusSelf = false;\n    zrUtil.each(this._svgGraphicRecord.named, function (namedItem) {\n      // Note that we also allow different elements have the same name.\n      // For example, a glyph of a city and the label of the city have\n      // the same name and their tooltip info can be defined in a single\n      // region option.\n      var regionName = namedItem.name;\n      var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n      var data = viewBuildCtx.data;\n      var svgNodeTagLower = namedItem.svgNodeTagLower;\n      var el = namedItem.el;\n      var dataIdx = data ? data.indexOfName(regionName) : null;\n      var regionModel = mapOrGeoModel.getRegionModel(regionName);\n\n      if (OPTION_STYLE_ENABLED_TAG_MAP.get(svgNodeTagLower) != null && el instanceof Displayable) {\n        applyOptionStyleForRegion(viewBuildCtx, el, dataIdx, regionModel);\n      }\n\n      if (el instanceof Displayable) {\n        el.culling = true;\n      } // We do not know how the SVG like so we'd better not to change z2.\n      // Otherwise it might bring some unexpected result. For example,\n      // an area hovered that make some inner city can not be clicked.\n\n\n      el.z2EmphasisLift = 0; // If self named, that is, if tag is inside a named <g> (where `namedFrom` does not exists):\n\n      if (!namedItem.namedFrom) {\n        // label should batter to be displayed based on the center of <g>\n        // if it is named rather than displayed on each child.\n        if (LABEL_HOST_MAP.get(svgNodeTagLower) != null) {\n          resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx, null);\n        }\n\n        resetEventTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx);\n        resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n        if (STATE_TRIGGER_TAG_MAP.get(svgNodeTagLower) != null) {\n          var focus_1 = resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n          if (focus_1 === 'self') {\n            focusSelf = true;\n          }\n\n          var els = svgDispatcherMap.get(regionName) || svgDispatcherMap.set(regionName, []);\n          els.push(el);\n        }\n      }\n    }, this);\n\n    this._enableBlurEntireSVG(focusSelf, viewBuildCtx);\n  };\n\n  MapDraw.prototype._enableBlurEntireSVG = function (focusSelf, viewBuildCtx) {\n    // It's a little complicated to support blurring the entire geoSVG in series-map.\n    // So do not suport it until some requirements come.\n    // At present, in series-map, only regions can be blurred.\n    if (focusSelf && viewBuildCtx.isGeo) {\n      var blurStyle = viewBuildCtx.mapOrGeoModel.getModel(['blur', 'itemStyle']).getItemStyle(); // Only suport `opacity` here. Because not sure that other props are suitable for\n      // all of the elements generated by SVG (especially for Text/TSpan/Image/... ).\n\n      var opacity_1 = blurStyle.opacity;\n\n      this._svgGraphicRecord.root.traverse(function (el) {\n        if (!el.isGroup) {\n          // PENDING: clear those settings to SVG elements when `_freeSVG`.\n          // (Currently it happen not to be needed.)\n          setDefaultStateProxy(el);\n          var style = el.ensureState('blur').style || {}; // Do not overwrite the region style that already set from region option.\n\n          if (style.opacity == null && opacity_1 != null) {\n            style.opacity = opacity_1;\n          } // If `ensureState('blur').style = {}`, there will be default opacity.\n          // Enable `stateTransition` (animation).\n\n\n          el.ensureState('emphasis');\n        }\n      });\n    }\n  };\n\n  MapDraw.prototype.remove = function () {\n    this._regionsGroup.removeAll();\n\n    this._regionsGroupByName = null;\n\n    this._svgGroup.removeAll();\n\n    this._freeSVG();\n\n    this._controller.dispose();\n\n    this._controllerHost = null;\n  };\n\n  MapDraw.prototype.findHighDownDispatchers = function (name, geoModel) {\n    if (name == null) {\n      return [];\n    }\n\n    var geo = geoModel.coordinateSystem;\n\n    if (geo.resourceType === 'geoJSON') {\n      var regionsGroupByName = this._regionsGroupByName;\n\n      if (regionsGroupByName) {\n        var regionGroup = regionsGroupByName.get(name);\n        return regionGroup ? [regionGroup] : [];\n      }\n    } else if (geo.resourceType === 'geoSVG') {\n      return this._svgDispatcherMap && this._svgDispatcherMap.get(name) || [];\n    }\n  };\n\n  MapDraw.prototype._svgResourceChanged = function (mapName) {\n    return this._svgMapName !== mapName;\n  };\n\n  MapDraw.prototype._useSVG = function (mapName) {\n    var resource = geoSourceManager.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      var svgGraphic = resource.useGraphic(this.uid);\n\n      this._svgGroup.add(svgGraphic.root);\n\n      this._svgGraphicRecord = svgGraphic;\n      this._svgMapName = mapName;\n    }\n  };\n\n  MapDraw.prototype._freeSVG = function () {\n    var mapName = this._svgMapName;\n\n    if (mapName == null) {\n      return;\n    }\n\n    var resource = geoSourceManager.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      resource.freeGraphic(this.uid);\n    }\n\n    this._svgGraphicRecord = null;\n    this._svgDispatcherMap = null;\n\n    this._svgGroup.removeAll();\n\n    this._svgMapName = null;\n  };\n\n  MapDraw.prototype._updateController = function (mapOrGeoModel, ecModel, api) {\n    var geo = mapOrGeoModel.coordinateSystem;\n    var controller = this._controller;\n    var controllerHost = this._controllerHost; // @ts-ignore FIXME:TS\n\n    controllerHost.zoomLimit = mapOrGeoModel.get('scaleLimit');\n    controllerHost.zoom = geo.getZoom(); // roamType is will be set default true if it is null\n    // @ts-ignore FIXME:TS\n\n    controller.enable(mapOrGeoModel.get('roam') || false);\n    var mainType = mapOrGeoModel.mainType;\n\n    function makeActionBase() {\n      var action = {\n        type: 'geoRoam',\n        componentType: mainType\n      };\n      action[mainType + 'Id'] = mapOrGeoModel.id;\n      return action;\n    }\n\n    controller.off('pan').on('pan', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnPan(controllerHost, e.dx, e.dy);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        dx: e.dx,\n        dy: e.dy\n      }));\n    }, this);\n    controller.off('zoom').on('zoom', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnZoom(controllerHost, e.scale, e.originX, e.originY);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        zoom: e.scale,\n        originX: e.originX,\n        originY: e.originY\n      }));\n    }, this);\n    controller.setPointerChecker(function (e, x, y) {\n      return geo.containPoint([x, y]) && !onIrrelevantElement(e, api, mapOrGeoModel);\n    });\n  };\n  /**\n   * FIXME: this is a temporarily workaround.\n   * When `geoRoam` the elements need to be reset in `MapView['render']`, because the props like\n   * `ignore` might have been modified by `LabelManager`, and `LabelManager#addLabelsOfSeries`\n   * will subsequently cache `defaultAttr` like `ignore`. If do not do this reset, the modified\n   * props will have no chance to be restored.\n   * Note: this reset should be after `clearStates` in `renderSeries` becuase `useStates` in\n   * `renderSeries` will cache the modified `ignore` to `el._normalState`.\n   * TODO:\n   * Use clone/immutable in `LabelManager`?\n   */\n\n\n  MapDraw.prototype.resetForLabelLayout = function () {\n    this.group.traverse(function (el) {\n      var label = el.getTextContent();\n\n      if (label) {\n        label.ignore = mapLabelRaw(label).ignore;\n      }\n    });\n  };\n\n  MapDraw.prototype._updateMapSelectHandler = function (mapOrGeoModel, regionsGroup, api, fromView) {\n    var mapDraw = this;\n    regionsGroup.off('mousedown');\n    regionsGroup.off('click'); // @ts-ignore FIXME:TS resolve type conflict\n\n    if (mapOrGeoModel.get('selectedMode')) {\n      regionsGroup.on('mousedown', function () {\n        mapDraw._mouseDownFlag = true;\n      });\n      regionsGroup.on('click', function (e) {\n        if (!mapDraw._mouseDownFlag) {\n          return;\n        }\n\n        mapDraw._mouseDownFlag = false;\n      });\n    }\n  };\n\n  return MapDraw;\n}();\n\n;\n\nfunction applyOptionStyleForRegion(viewBuildCtx, el, dataIndex, regionModel) {\n  // All of the path are using `itemStyle`, becuase\n  // (1) Some SVG also use fill on polyline (The different between\n  // polyline and polygon is \"open\" or \"close\" but not fill or not).\n  // (2) For the common props like opacity, if some use itemStyle\n  // and some use `lineStyle`, it might confuse users.\n  // (3) Most SVG use <path>, where can not detect wether draw a \"line\"\n  // or a filled shape, so use `itemStyle` for <path>.\n  var normalStyleModel = regionModel.getModel('itemStyle');\n  var emphasisStyleModel = regionModel.getModel(['emphasis', 'itemStyle']);\n  var blurStyleModel = regionModel.getModel(['blur', 'itemStyle']);\n  var selectStyleModel = regionModel.getModel(['select', 'itemStyle']); // NOTE: DONT use 'style' in visual when drawing map.\n  // This component is used for drawing underlying map for both geo component and map series.\n\n  var normalStyle = getFixedItemStyle(normalStyleModel);\n  var emphasisStyle = getFixedItemStyle(emphasisStyleModel);\n  var selectStyle = getFixedItemStyle(selectStyleModel);\n  var blurStyle = getFixedItemStyle(blurStyleModel); // Update the itemStyle if has data visual\n\n  var data = viewBuildCtx.data;\n\n  if (data) {\n    // Only visual color of each item will be used. It can be encoded by visualMap\n    // But visual color of series is used in symbol drawing\n    // Visual color for each series is for the symbol draw\n    var style = data.getItemVisual(dataIndex, 'style');\n    var decal = data.getItemVisual(dataIndex, 'decal');\n\n    if (viewBuildCtx.isVisualEncodedByVisualMap && style.fill) {\n      normalStyle.fill = style.fill;\n    }\n\n    if (decal) {\n      normalStyle.decal = createOrUpdatePatternFromDecal(decal, viewBuildCtx.api);\n    }\n  } // SVG text, tspan and image can be named but not supporeted\n  // to be styled by region option yet.\n\n\n  el.setStyle(normalStyle);\n  el.style.strokeNoScale = true;\n  el.ensureState('emphasis').style = emphasisStyle;\n  el.ensureState('select').style = selectStyle;\n  el.ensureState('blur').style = blurStyle; // Enable blur\n\n  setDefaultStateProxy(el);\n}\n\nfunction resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx, // If labelXY not provided, use `textConfig.position: 'inside'`\nlabelXY) {\n  var data = viewBuildCtx.data;\n  var isGeo = viewBuildCtx.isGeo;\n  var isDataNaN = data && isNaN(data.get(data.mapDimension('value'), dataIdx));\n  var itemLayout = data && data.getItemLayout(dataIdx); // In the following cases label will be drawn\n  // 1. In map series and data value is NaN\n  // 2. In geo component\n  // 3. Region has no series legendSymbol, which will be add a showLabel flag in mapSymbolLayout\n\n  if (isGeo || isDataNaN || itemLayout && itemLayout.showLabel) {\n    var query = !isGeo ? dataIdx : regionName;\n    var labelFetcher = void 0; // Consider dataIdx not found.\n\n    if (!data || dataIdx >= 0) {\n      labelFetcher = mapOrGeoModel;\n    }\n\n    var specifiedTextOpt = labelXY ? {\n      normal: {\n        align: 'center',\n        verticalAlign: 'middle'\n      }\n    } : null; // Caveat: must be called after `setDefaultStateProxy(el);` called.\n    // because textContent will be assign with `el.stateProxy` inside.\n\n    setLabelStyle(el, getLabelStatesModels(regionModel), {\n      labelFetcher: labelFetcher,\n      labelDataIndex: query,\n      defaultText: regionName\n    }, specifiedTextOpt);\n    var textEl = el.getTextContent();\n\n    if (textEl) {\n      mapLabelRaw(textEl).ignore = textEl.ignore;\n\n      if (el.textConfig) {\n        if (labelXY) {\n          // Compute a relative offset based on the el bounding rect.\n          var rect = el.getBoundingRect().clone();\n          el.textConfig.position = [(labelXY[0] - rect.x) / rect.width * 100 + '%', (labelXY[1] - rect.y) / rect.height * 100 + '%'];\n        }\n      }\n    }\n\n    enableLayoutLayoutFeatures(el, dataIdx, null);\n    el.disableLabelAnimation = true;\n  } else {\n    el.removeTextContent();\n    el.removeTextConfig();\n    el.disableLabelAnimation = null;\n  }\n}\n\nfunction resetEventTriggerForRegion(viewBuildCtx, eventTrigger, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx) {\n  // setItemGraphicEl, setHoverStyle after all polygons and labels\n  // are added to the rigionGroup\n  if (viewBuildCtx.data) {\n    // FIXME: when series-map use a SVG map, and there are duplicated name specified\n    // on different SVG elements, after `data.setItemGraphicEl(...)`:\n    // (1) all of them will be mounted with `dataIndex`, `seriesIndex`, so that tooltip\n    // can be triggered only mouse hover. That's correct.\n    // (2) only the last element will be kept in `data`, so that if trigger tooltip\n    // by `dispatchAction`, only the last one can be found and triggered. That might be\n    // not correct. We will fix it in future if anyone demanding that.\n    viewBuildCtx.data.setItemGraphicEl(dataIdx, eventTrigger);\n  } // series-map will not trigger \"geoselectchange\" no matter it is\n  // based on a declared geo component. Becuause series-map will\n  // trigger \"selectchange\". If it trigger both the two events,\n  // If users call `chart.dispatchAction({type: 'toggleSelect'})`,\n  // it not easy to also fire event \"geoselectchanged\".\n  else {\n      // Package custom mouse event for geo component\n      getECData(eventTrigger).eventData = {\n        componentType: 'geo',\n        componentIndex: mapOrGeoModel.componentIndex,\n        geoIndex: mapOrGeoModel.componentIndex,\n        name: regionName,\n        region: regionModel && regionModel.option || {}\n      };\n    }\n}\n\nfunction resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  if (!viewBuildCtx.data) {\n    graphic.setTooltipConfig({\n      el: el,\n      componentModel: mapOrGeoModel,\n      itemName: regionName,\n      // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n      itemTooltipOption: regionModel.get('tooltip')\n    });\n  }\n}\n\nfunction resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n  el.highDownSilentOnTouch = !!mapOrGeoModel.get('selectedMode'); // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n\n  var emphasisModel = regionModel.getModel('emphasis');\n  var focus = emphasisModel.get('focus');\n  enableHoverEmphasis(el, focus, emphasisModel.get('blurScope'));\n\n  if (viewBuildCtx.isGeo) {\n    enableComponentHighDownFeatures(el, mapOrGeoModel, regionName);\n  }\n\n  return focus;\n}\n\nexport default MapDraw; // @ts-ignore FIXME:TS fix the \"compatible with each other\"?","map":{"version":3,"sources":["C:/Users/PC/Desktop/源码/react_Project/react-project/node_modules/echarts/lib/component/helper/MapDraw.js"],"names":["zrUtil","RoamController","roamHelper","onIrrelevantElement","graphic","enableHoverEmphasis","enableComponentHighDownFeatures","setDefaultStateProxy","geoSourceManager","getUID","setLabelStyle","getLabelStatesModels","enableLayoutLayoutFeatures","getECData","createOrUpdatePatternFromDecal","Displayable","makeInner","OPTION_STYLE_ENABLED_TAGS","OPTION_STYLE_ENABLED_TAG_MAP","createHashMap","STATE_TRIGGER_TAG_MAP","concat","LABEL_HOST_MAP","mapLabelRaw","getFixedItemStyle","model","itemStyle","getItemStyle","areaColor","get","fill","MapDraw","api","group","Group","uid","_controller","getZr","_controllerHost","target","add","_regionsGroup","_svgGroup","prototype","draw","mapOrGeoModel","ecModel","fromView","payload","isGeo","mainType","data","getData","eachComponent","subType","mapSeries","getHostGeoModel","geo","coordinateSystem","regionsGroup","transformInfo","getTransformInfo","transformInfoRaw","raw","transformInfoRoam","roam","isFirstDraw","childAt","x","y","scaleX","scaleY","dirty","updateProps","isVisualEncodedByVisualMap","getVisual","length","viewBuildCtx","resourceType","_buildGeoJSON","_buildSVG","_updateController","_updateMapSelectHandler","nameMap","_regionsGroupByName","transformPoint","point","removeAll","each","regions","region","regionName","name","regionModel","getRegionModel","dataIdx","indexOfName","regionGroup","hasRegionGroup","set","compoundPath","CompoundPath","segmentIgnoreThreshold","shape","paths","resetEventTriggerForRegion","resetTooltipForRegion","resetStateTriggerForRegion","geometries","geometry","type","points","i","exterior","push","Polygon","interiors","interior","points_1","j","applyOptionStyleForRegion","culling","centerPt","getCenter","resetLabelForRegion","mapName","map","_svgResourceChanged","_freeSVG","_useSVG","svgDispatcherMap","_svgDispatcherMap","focusSelf","_svgGraphicRecord","named","namedItem","svgNodeTagLower","el","z2EmphasisLift","namedFrom","focus_1","els","_enableBlurEntireSVG","blurStyle","getModel","opacity_1","opacity","root","traverse","isGroup","style","ensureState","remove","dispose","findHighDownDispatchers","geoModel","regionsGroupByName","_svgMapName","resource","getGeoResource","svgGraphic","useGraphic","freeGraphic","controller","controllerHost","zoomLimit","zoom","getZoom","enable","makeActionBase","action","componentType","id","off","on","e","_mouseDownFlag","updateViewOnPan","dx","dy","dispatchAction","extend","updateViewOnZoom","scale","originX","originY","setPointerChecker","containPoint","resetForLabelLayout","label","getTextContent","ignore","mapDraw","dataIndex","normalStyleModel","emphasisStyleModel","blurStyleModel","selectStyleModel","normalStyle","emphasisStyle","selectStyle","getItemVisual","decal","setStyle","strokeNoScale","labelXY","isDataNaN","isNaN","mapDimension","itemLayout","getItemLayout","showLabel","query","labelFetcher","specifiedTextOpt","normal","align","verticalAlign","labelDataIndex","defaultText","textEl","textConfig","rect","getBoundingRect","clone","position","width","height","disableLabelAnimation","removeTextContent","removeTextConfig","eventTrigger","setItemGraphicEl","eventData","componentIndex","geoIndex","option","setTooltipConfig","componentModel","itemName","itemTooltipOption","highDownSilentOnTouch","emphasisModel","focus"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util';\nimport RoamController from './RoamController';\nimport * as roamHelper from '../../component/helper/roamHelper';\nimport { onIrrelevantElement } from '../../component/helper/cursorHelper';\nimport * as graphic from '../../util/graphic';\nimport { enableHoverEmphasis, enableComponentHighDownFeatures, setDefaultStateProxy } from '../../util/states';\nimport geoSourceManager from '../../coord/geo/geoSourceManager';\nimport { getUID } from '../../util/component';\nimport { setLabelStyle, getLabelStatesModels, enableLayoutLayoutFeatures } from '../../label/labelStyle';\nimport { getECData } from '../../util/innerStore';\nimport { createOrUpdatePatternFromDecal } from '../../util/decal';\nimport Displayable from 'zrender/lib/graphic/Displayable';\nimport { makeInner } from '../../util/model';\n/**\n * Only these tags enable use `itemStyle` if they are named in SVG.\n * Other tags like <text> <tspan> <image> might not suitable for `itemStyle`.\n * They will not be considered to be styled until some requirements come.\n */\n\nvar OPTION_STYLE_ENABLED_TAGS = ['rect', 'circle', 'line', 'ellipse', 'polygon', 'polyline', 'path'];\nvar OPTION_STYLE_ENABLED_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS);\nvar STATE_TRIGGER_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar LABEL_HOST_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar mapLabelRaw = makeInner();\n\nfunction getFixedItemStyle(model) {\n  var itemStyle = model.getItemStyle();\n  var areaColor = model.get('areaColor'); // If user want the color not to be changed when hover,\n  // they should both set areaColor and color to be null.\n\n  if (areaColor != null) {\n    itemStyle.fill = areaColor;\n  }\n\n  return itemStyle;\n}\n\nvar MapDraw =\n/** @class */\nfunction () {\n  function MapDraw(api) {\n    var group = new graphic.Group();\n    this.uid = getUID('ec_map_draw');\n    this._controller = new RoamController(api.getZr());\n    this._controllerHost = {\n      target: group\n    };\n    this.group = group;\n    group.add(this._regionsGroup = new graphic.Group());\n    group.add(this._svgGroup = new graphic.Group());\n  }\n\n  MapDraw.prototype.draw = function (mapOrGeoModel, ecModel, api, fromView, payload) {\n    var isGeo = mapOrGeoModel.mainType === 'geo'; // Map series has data. GEO model that controlled by map series\n    // will be assigned with map data. Other GEO model has no data.\n\n    var data = mapOrGeoModel.getData && mapOrGeoModel.getData();\n    isGeo && ecModel.eachComponent({\n      mainType: 'series',\n      subType: 'map'\n    }, function (mapSeries) {\n      if (!data && mapSeries.getHostGeoModel() === mapOrGeoModel) {\n        data = mapSeries.getData();\n      }\n    });\n    var geo = mapOrGeoModel.coordinateSystem;\n    var regionsGroup = this._regionsGroup;\n    var group = this.group;\n    var transformInfo = geo.getTransformInfo();\n    var transformInfoRaw = transformInfo.raw;\n    var transformInfoRoam = transformInfo.roam; // No animation when first draw or in action\n\n    var isFirstDraw = !regionsGroup.childAt(0) || payload;\n\n    if (isFirstDraw) {\n      group.x = transformInfoRoam.x;\n      group.y = transformInfoRoam.y;\n      group.scaleX = transformInfoRoam.scaleX;\n      group.scaleY = transformInfoRoam.scaleY;\n      group.dirty();\n    } else {\n      graphic.updateProps(group, transformInfoRoam, mapOrGeoModel);\n    }\n\n    var isVisualEncodedByVisualMap = data && data.getVisual('visualMeta') && data.getVisual('visualMeta').length > 0;\n    var viewBuildCtx = {\n      api: api,\n      geo: geo,\n      mapOrGeoModel: mapOrGeoModel,\n      data: data,\n      isVisualEncodedByVisualMap: isVisualEncodedByVisualMap,\n      isGeo: isGeo,\n      transformInfoRaw: transformInfoRaw\n    };\n\n    if (geo.resourceType === 'geoJSON') {\n      this._buildGeoJSON(viewBuildCtx);\n    } else if (geo.resourceType === 'geoSVG') {\n      this._buildSVG(viewBuildCtx);\n    }\n\n    this._updateController(mapOrGeoModel, ecModel, api);\n\n    this._updateMapSelectHandler(mapOrGeoModel, regionsGroup, api, fromView);\n  };\n\n  MapDraw.prototype._buildGeoJSON = function (viewBuildCtx) {\n    var nameMap = this._regionsGroupByName = zrUtil.createHashMap();\n    var regionsGroup = this._regionsGroup;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n    var data = viewBuildCtx.data;\n\n    var transformPoint = function (point) {\n      return [point[0] * transformInfoRaw.scaleX + transformInfoRaw.x, point[1] * transformInfoRaw.scaleY + transformInfoRaw.y];\n    };\n\n    regionsGroup.removeAll(); // Only when the resource is GeoJSON, there is `geo.regions`.\n\n    zrUtil.each(viewBuildCtx.geo.regions, function (region) {\n      var regionName = region.name;\n      var regionModel = mapOrGeoModel.getRegionModel(regionName);\n      var dataIdx = data ? data.indexOfName(regionName) : null; // Consider in GeoJson properties.name may be duplicated, for example,\n      // there is multiple region named \"United Kindom\" or \"France\" (so many\n      // colonies). And it is not appropriate to merge them in geo, which\n      // will make them share the same label and bring trouble in label\n      // location calculation.\n\n      var regionGroup = nameMap.get(regionName);\n      var hasRegionGroup = !!regionGroup;\n\n      if (!hasRegionGroup) {\n        regionGroup = nameMap.set(regionName, new graphic.Group());\n        regionsGroup.add(regionGroup);\n      }\n\n      var compoundPath = new graphic.CompoundPath({\n        segmentIgnoreThreshold: 1,\n        shape: {\n          paths: []\n        }\n      });\n      regionGroup.add(compoundPath);\n\n      if (!hasRegionGroup) {\n        // ensure children have been added to group before calling resetEventTriggerForRegion\n        resetEventTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel, dataIdx);\n        resetTooltipForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n        resetStateTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n      }\n\n      zrUtil.each(region.geometries, function (geometry) {\n        if (geometry.type !== 'polygon') {\n          return;\n        }\n\n        var points = [];\n\n        for (var i = 0; i < geometry.exterior.length; ++i) {\n          points.push(transformPoint(geometry.exterior[i]));\n        }\n\n        compoundPath.shape.paths.push(new graphic.Polygon({\n          segmentIgnoreThreshold: 1,\n          shape: {\n            points: points\n          }\n        }));\n\n        for (var i = 0; i < (geometry.interiors ? geometry.interiors.length : 0); ++i) {\n          var interior = geometry.interiors[i];\n          var points_1 = [];\n\n          for (var j = 0; j < interior.length; ++j) {\n            points_1.push(transformPoint(interior[j]));\n          }\n\n          compoundPath.shape.paths.push(new graphic.Polygon({\n            segmentIgnoreThreshold: 1,\n            shape: {\n              points: points_1\n            }\n          }));\n        }\n      });\n      applyOptionStyleForRegion(viewBuildCtx, compoundPath, dataIdx, regionModel);\n\n      if (compoundPath instanceof Displayable) {\n        compoundPath.culling = true;\n      }\n\n      var centerPt = transformPoint(region.getCenter());\n      resetLabelForRegion(viewBuildCtx, compoundPath, regionName, regionModel, mapOrGeoModel, dataIdx, centerPt);\n    }, this);\n  };\n\n  MapDraw.prototype._buildSVG = function (viewBuildCtx) {\n    var mapName = viewBuildCtx.geo.map;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    this._svgGroup.x = transformInfoRaw.x;\n    this._svgGroup.y = transformInfoRaw.y;\n    this._svgGroup.scaleX = transformInfoRaw.scaleX;\n    this._svgGroup.scaleY = transformInfoRaw.scaleY;\n\n    if (this._svgResourceChanged(mapName)) {\n      this._freeSVG();\n\n      this._useSVG(mapName);\n    }\n\n    var svgDispatcherMap = this._svgDispatcherMap = zrUtil.createHashMap();\n    var focusSelf = false;\n    zrUtil.each(this._svgGraphicRecord.named, function (namedItem) {\n      // Note that we also allow different elements have the same name.\n      // For example, a glyph of a city and the label of the city have\n      // the same name and their tooltip info can be defined in a single\n      // region option.\n      var regionName = namedItem.name;\n      var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n      var data = viewBuildCtx.data;\n      var svgNodeTagLower = namedItem.svgNodeTagLower;\n      var el = namedItem.el;\n      var dataIdx = data ? data.indexOfName(regionName) : null;\n      var regionModel = mapOrGeoModel.getRegionModel(regionName);\n\n      if (OPTION_STYLE_ENABLED_TAG_MAP.get(svgNodeTagLower) != null && el instanceof Displayable) {\n        applyOptionStyleForRegion(viewBuildCtx, el, dataIdx, regionModel);\n      }\n\n      if (el instanceof Displayable) {\n        el.culling = true;\n      } // We do not know how the SVG like so we'd better not to change z2.\n      // Otherwise it might bring some unexpected result. For example,\n      // an area hovered that make some inner city can not be clicked.\n\n\n      el.z2EmphasisLift = 0; // If self named, that is, if tag is inside a named <g> (where `namedFrom` does not exists):\n\n      if (!namedItem.namedFrom) {\n        // label should batter to be displayed based on the center of <g>\n        // if it is named rather than displayed on each child.\n        if (LABEL_HOST_MAP.get(svgNodeTagLower) != null) {\n          resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx, null);\n        }\n\n        resetEventTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx);\n        resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n        if (STATE_TRIGGER_TAG_MAP.get(svgNodeTagLower) != null) {\n          var focus_1 = resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n          if (focus_1 === 'self') {\n            focusSelf = true;\n          }\n\n          var els = svgDispatcherMap.get(regionName) || svgDispatcherMap.set(regionName, []);\n          els.push(el);\n        }\n      }\n    }, this);\n\n    this._enableBlurEntireSVG(focusSelf, viewBuildCtx);\n  };\n\n  MapDraw.prototype._enableBlurEntireSVG = function (focusSelf, viewBuildCtx) {\n    // It's a little complicated to support blurring the entire geoSVG in series-map.\n    // So do not suport it until some requirements come.\n    // At present, in series-map, only regions can be blurred.\n    if (focusSelf && viewBuildCtx.isGeo) {\n      var blurStyle = viewBuildCtx.mapOrGeoModel.getModel(['blur', 'itemStyle']).getItemStyle(); // Only suport `opacity` here. Because not sure that other props are suitable for\n      // all of the elements generated by SVG (especially for Text/TSpan/Image/... ).\n\n      var opacity_1 = blurStyle.opacity;\n\n      this._svgGraphicRecord.root.traverse(function (el) {\n        if (!el.isGroup) {\n          // PENDING: clear those settings to SVG elements when `_freeSVG`.\n          // (Currently it happen not to be needed.)\n          setDefaultStateProxy(el);\n          var style = el.ensureState('blur').style || {}; // Do not overwrite the region style that already set from region option.\n\n          if (style.opacity == null && opacity_1 != null) {\n            style.opacity = opacity_1;\n          } // If `ensureState('blur').style = {}`, there will be default opacity.\n          // Enable `stateTransition` (animation).\n\n\n          el.ensureState('emphasis');\n        }\n      });\n    }\n  };\n\n  MapDraw.prototype.remove = function () {\n    this._regionsGroup.removeAll();\n\n    this._regionsGroupByName = null;\n\n    this._svgGroup.removeAll();\n\n    this._freeSVG();\n\n    this._controller.dispose();\n\n    this._controllerHost = null;\n  };\n\n  MapDraw.prototype.findHighDownDispatchers = function (name, geoModel) {\n    if (name == null) {\n      return [];\n    }\n\n    var geo = geoModel.coordinateSystem;\n\n    if (geo.resourceType === 'geoJSON') {\n      var regionsGroupByName = this._regionsGroupByName;\n\n      if (regionsGroupByName) {\n        var regionGroup = regionsGroupByName.get(name);\n        return regionGroup ? [regionGroup] : [];\n      }\n    } else if (geo.resourceType === 'geoSVG') {\n      return this._svgDispatcherMap && this._svgDispatcherMap.get(name) || [];\n    }\n  };\n\n  MapDraw.prototype._svgResourceChanged = function (mapName) {\n    return this._svgMapName !== mapName;\n  };\n\n  MapDraw.prototype._useSVG = function (mapName) {\n    var resource = geoSourceManager.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      var svgGraphic = resource.useGraphic(this.uid);\n\n      this._svgGroup.add(svgGraphic.root);\n\n      this._svgGraphicRecord = svgGraphic;\n      this._svgMapName = mapName;\n    }\n  };\n\n  MapDraw.prototype._freeSVG = function () {\n    var mapName = this._svgMapName;\n\n    if (mapName == null) {\n      return;\n    }\n\n    var resource = geoSourceManager.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      resource.freeGraphic(this.uid);\n    }\n\n    this._svgGraphicRecord = null;\n    this._svgDispatcherMap = null;\n\n    this._svgGroup.removeAll();\n\n    this._svgMapName = null;\n  };\n\n  MapDraw.prototype._updateController = function (mapOrGeoModel, ecModel, api) {\n    var geo = mapOrGeoModel.coordinateSystem;\n    var controller = this._controller;\n    var controllerHost = this._controllerHost; // @ts-ignore FIXME:TS\n\n    controllerHost.zoomLimit = mapOrGeoModel.get('scaleLimit');\n    controllerHost.zoom = geo.getZoom(); // roamType is will be set default true if it is null\n    // @ts-ignore FIXME:TS\n\n    controller.enable(mapOrGeoModel.get('roam') || false);\n    var mainType = mapOrGeoModel.mainType;\n\n    function makeActionBase() {\n      var action = {\n        type: 'geoRoam',\n        componentType: mainType\n      };\n      action[mainType + 'Id'] = mapOrGeoModel.id;\n      return action;\n    }\n\n    controller.off('pan').on('pan', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnPan(controllerHost, e.dx, e.dy);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        dx: e.dx,\n        dy: e.dy\n      }));\n    }, this);\n    controller.off('zoom').on('zoom', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnZoom(controllerHost, e.scale, e.originX, e.originY);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        zoom: e.scale,\n        originX: e.originX,\n        originY: e.originY\n      }));\n    }, this);\n    controller.setPointerChecker(function (e, x, y) {\n      return geo.containPoint([x, y]) && !onIrrelevantElement(e, api, mapOrGeoModel);\n    });\n  };\n  /**\n   * FIXME: this is a temporarily workaround.\n   * When `geoRoam` the elements need to be reset in `MapView['render']`, because the props like\n   * `ignore` might have been modified by `LabelManager`, and `LabelManager#addLabelsOfSeries`\n   * will subsequently cache `defaultAttr` like `ignore`. If do not do this reset, the modified\n   * props will have no chance to be restored.\n   * Note: this reset should be after `clearStates` in `renderSeries` becuase `useStates` in\n   * `renderSeries` will cache the modified `ignore` to `el._normalState`.\n   * TODO:\n   * Use clone/immutable in `LabelManager`?\n   */\n\n\n  MapDraw.prototype.resetForLabelLayout = function () {\n    this.group.traverse(function (el) {\n      var label = el.getTextContent();\n\n      if (label) {\n        label.ignore = mapLabelRaw(label).ignore;\n      }\n    });\n  };\n\n  MapDraw.prototype._updateMapSelectHandler = function (mapOrGeoModel, regionsGroup, api, fromView) {\n    var mapDraw = this;\n    regionsGroup.off('mousedown');\n    regionsGroup.off('click'); // @ts-ignore FIXME:TS resolve type conflict\n\n    if (mapOrGeoModel.get('selectedMode')) {\n      regionsGroup.on('mousedown', function () {\n        mapDraw._mouseDownFlag = true;\n      });\n      regionsGroup.on('click', function (e) {\n        if (!mapDraw._mouseDownFlag) {\n          return;\n        }\n\n        mapDraw._mouseDownFlag = false;\n      });\n    }\n  };\n\n  return MapDraw;\n}();\n\n;\n\nfunction applyOptionStyleForRegion(viewBuildCtx, el, dataIndex, regionModel) {\n  // All of the path are using `itemStyle`, becuase\n  // (1) Some SVG also use fill on polyline (The different between\n  // polyline and polygon is \"open\" or \"close\" but not fill or not).\n  // (2) For the common props like opacity, if some use itemStyle\n  // and some use `lineStyle`, it might confuse users.\n  // (3) Most SVG use <path>, where can not detect wether draw a \"line\"\n  // or a filled shape, so use `itemStyle` for <path>.\n  var normalStyleModel = regionModel.getModel('itemStyle');\n  var emphasisStyleModel = regionModel.getModel(['emphasis', 'itemStyle']);\n  var blurStyleModel = regionModel.getModel(['blur', 'itemStyle']);\n  var selectStyleModel = regionModel.getModel(['select', 'itemStyle']); // NOTE: DONT use 'style' in visual when drawing map.\n  // This component is used for drawing underlying map for both geo component and map series.\n\n  var normalStyle = getFixedItemStyle(normalStyleModel);\n  var emphasisStyle = getFixedItemStyle(emphasisStyleModel);\n  var selectStyle = getFixedItemStyle(selectStyleModel);\n  var blurStyle = getFixedItemStyle(blurStyleModel); // Update the itemStyle if has data visual\n\n  var data = viewBuildCtx.data;\n\n  if (data) {\n    // Only visual color of each item will be used. It can be encoded by visualMap\n    // But visual color of series is used in symbol drawing\n    // Visual color for each series is for the symbol draw\n    var style = data.getItemVisual(dataIndex, 'style');\n    var decal = data.getItemVisual(dataIndex, 'decal');\n\n    if (viewBuildCtx.isVisualEncodedByVisualMap && style.fill) {\n      normalStyle.fill = style.fill;\n    }\n\n    if (decal) {\n      normalStyle.decal = createOrUpdatePatternFromDecal(decal, viewBuildCtx.api);\n    }\n  } // SVG text, tspan and image can be named but not supporeted\n  // to be styled by region option yet.\n\n\n  el.setStyle(normalStyle);\n  el.style.strokeNoScale = true;\n  el.ensureState('emphasis').style = emphasisStyle;\n  el.ensureState('select').style = selectStyle;\n  el.ensureState('blur').style = blurStyle; // Enable blur\n\n  setDefaultStateProxy(el);\n}\n\nfunction resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx, // If labelXY not provided, use `textConfig.position: 'inside'`\nlabelXY) {\n  var data = viewBuildCtx.data;\n  var isGeo = viewBuildCtx.isGeo;\n  var isDataNaN = data && isNaN(data.get(data.mapDimension('value'), dataIdx));\n  var itemLayout = data && data.getItemLayout(dataIdx); // In the following cases label will be drawn\n  // 1. In map series and data value is NaN\n  // 2. In geo component\n  // 3. Region has no series legendSymbol, which will be add a showLabel flag in mapSymbolLayout\n\n  if (isGeo || isDataNaN || itemLayout && itemLayout.showLabel) {\n    var query = !isGeo ? dataIdx : regionName;\n    var labelFetcher = void 0; // Consider dataIdx not found.\n\n    if (!data || dataIdx >= 0) {\n      labelFetcher = mapOrGeoModel;\n    }\n\n    var specifiedTextOpt = labelXY ? {\n      normal: {\n        align: 'center',\n        verticalAlign: 'middle'\n      }\n    } : null; // Caveat: must be called after `setDefaultStateProxy(el);` called.\n    // because textContent will be assign with `el.stateProxy` inside.\n\n    setLabelStyle(el, getLabelStatesModels(regionModel), {\n      labelFetcher: labelFetcher,\n      labelDataIndex: query,\n      defaultText: regionName\n    }, specifiedTextOpt);\n    var textEl = el.getTextContent();\n\n    if (textEl) {\n      mapLabelRaw(textEl).ignore = textEl.ignore;\n\n      if (el.textConfig) {\n        if (labelXY) {\n          // Compute a relative offset based on the el bounding rect.\n          var rect = el.getBoundingRect().clone();\n          el.textConfig.position = [(labelXY[0] - rect.x) / rect.width * 100 + '%', (labelXY[1] - rect.y) / rect.height * 100 + '%'];\n        }\n      }\n    }\n\n    enableLayoutLayoutFeatures(el, dataIdx, null);\n    el.disableLabelAnimation = true;\n  } else {\n    el.removeTextContent();\n    el.removeTextConfig();\n    el.disableLabelAnimation = null;\n  }\n}\n\nfunction resetEventTriggerForRegion(viewBuildCtx, eventTrigger, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx) {\n  // setItemGraphicEl, setHoverStyle after all polygons and labels\n  // are added to the rigionGroup\n  if (viewBuildCtx.data) {\n    // FIXME: when series-map use a SVG map, and there are duplicated name specified\n    // on different SVG elements, after `data.setItemGraphicEl(...)`:\n    // (1) all of them will be mounted with `dataIndex`, `seriesIndex`, so that tooltip\n    // can be triggered only mouse hover. That's correct.\n    // (2) only the last element will be kept in `data`, so that if trigger tooltip\n    // by `dispatchAction`, only the last one can be found and triggered. That might be\n    // not correct. We will fix it in future if anyone demanding that.\n    viewBuildCtx.data.setItemGraphicEl(dataIdx, eventTrigger);\n  } // series-map will not trigger \"geoselectchange\" no matter it is\n  // based on a declared geo component. Becuause series-map will\n  // trigger \"selectchange\". If it trigger both the two events,\n  // If users call `chart.dispatchAction({type: 'toggleSelect'})`,\n  // it not easy to also fire event \"geoselectchanged\".\n  else {\n      // Package custom mouse event for geo component\n      getECData(eventTrigger).eventData = {\n        componentType: 'geo',\n        componentIndex: mapOrGeoModel.componentIndex,\n        geoIndex: mapOrGeoModel.componentIndex,\n        name: regionName,\n        region: regionModel && regionModel.option || {}\n      };\n    }\n}\n\nfunction resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  if (!viewBuildCtx.data) {\n    graphic.setTooltipConfig({\n      el: el,\n      componentModel: mapOrGeoModel,\n      itemName: regionName,\n      // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n      itemTooltipOption: regionModel.get('tooltip')\n    });\n  }\n}\n\nfunction resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n  el.highDownSilentOnTouch = !!mapOrGeoModel.get('selectedMode'); // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n\n  var emphasisModel = regionModel.getModel('emphasis');\n  var focus = emphasisModel.get('focus');\n  enableHoverEmphasis(el, focus, emphasisModel.get('blurScope'));\n\n  if (viewBuildCtx.isGeo) {\n    enableComponentHighDownFeatures(el, mapOrGeoModel, regionName);\n  }\n\n  return focus;\n}\n\nexport default MapDraw; // @ts-ignore FIXME:TS fix the \"compatible with each other\"?"]},"metadata":{},"sourceType":"module"}