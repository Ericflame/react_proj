{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/tree/style\";\nimport _Tree from \"antd/es/tree\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\PC\\\\Desktop\\\\react-project\\\\src\\\\containers\\\\Role\\\\index.jsx\",\n    _dec,\n    _class,\n    _temp;\n\nimport React, { Component } from 'react';\nimport dayjs from 'dayjs';\nimport { reqRoleList, reqAddRole, reqAuthRole } from '../../api';\nimport menuList from '../../config/menu_config';\nimport { connect } from 'react-redux';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Item\n} = _Form;\nconst {\n  TreeNode\n} = _Tree;\nlet Role = (_dec = connect(state => ({\n  username: state.userInfo.user.username\n}), {}), _dec(_class = (_temp = class Role extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isShowAdd: false,\n      isShowAuth: false,\n      roleList: [],\n      menuList,\n      checkedKeys: [],\n      //选中的菜单\n      _id: '' //当前操作的角色id\n\n    };\n\n    this.getRoleList = async () => {\n      let result = await reqRoleList();\n      const {\n        status,\n        data\n      } = result;\n      if (status === 0) this.setState({\n        roleList: data\n      });\n    };\n\n    this.handleOk = () => {\n      this.props.form.validateFields(async (err, values) => {\n        if (err) return;\n        let result = await reqAddRole(values);\n        const {\n          status,\n          msg\n        } = result;\n\n        if (status === 0) {\n          _message.success('新增角色成功');\n\n          this.getRoleList();\n          this.setState({\n            isShowAdd: false\n          });\n        } else _message.error(msg);\n      });\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        isShowAdd: false\n      });\n    };\n\n    this.handleAuthOk = async () => {\n      const {\n        _id,\n        checkedKeys\n      } = this.state;\n      const {\n        username\n      } = this.props;\n      let result = await reqAuthRole({\n        _id,\n        menus: checkedKeys,\n        auth_name: username\n      });\n      const {\n        status,\n        data,\n        msg\n      } = result;\n\n      if (status === 0) {\n        _message.success('授权成功', 1);\n\n        this.setState({\n          isShowAuth: false\n        });\n        this.getRoleList();\n      } else _message.error(msg, 1);\n    };\n\n    this.handleAuthCancel = () => {\n      this.setState({\n        isShowAuth: false\n      });\n    };\n\n    this.onCheck = checkedKeys => this.setState({\n      checkedKeys\n    });\n\n    this.showAuth = id => {\n      const {\n        roleList\n      } = this.state;\n      let result = roleList.find(item => {\n        return item._id === id;\n      });\n      if (result) this.setState({\n        checkedKeys: result.menus\n      });\n      this.setState({\n        isShowAuth: true,\n        _id: id\n      });\n    };\n\n    this.showAdd = () => {\n      this.props.form.resetFields();\n      this.setState({\n        isShowAdd: true\n      });\n    };\n\n    this.renderTreeNodes = data => data.map(item => {\n      if (item.children) {\n        return /*#__PURE__*/_jsxDEV(TreeNode, {\n          title: item.title,\n          dataRef: item,\n          children: this.renderTreeNodes(item.children)\n        }, item.key, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this);\n      }\n\n      return /*#__PURE__*/_jsxDEV(TreeNode, { ...item\n      }, item.key, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 14\n      }, this);\n    });\n  }\n\n  componentDidMount() {\n    this.getRoleList();\n  } //新增角色--确认按钮\n\n\n  render() {\n    const dataSource = this.state.roleList;\n    const columns = [{\n      title: '角色名称',\n      dataIndex: 'name',\n      key: 'name'\n    }, {\n      title: '创建时间',\n      dataIndex: 'create_time',\n      key: 'create_time',\n      render: time => dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss')\n    }, {\n      title: '授权时间',\n      dataIndex: 'auth_time',\n      key: 'auth_time',\n      render: time => time ? dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss') : ''\n    }, {\n      title: '授权人',\n      dataIndex: 'auth_name',\n      key: 'auth_name'\n    }, {\n      title: '操作',\n      key: 'option',\n      render: item => /*#__PURE__*/_jsxDEV(_Button, {\n        type: \"link\",\n        onClick: () => {\n          this.showAuth(item._id);\n        },\n        children: \"\\u8BBE\\u7F6E\\u6743\\u9650\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 27\n      }, this)\n    }]; //treeData是属性菜单的源数据\n\n    const treeData = this.state.menuList;\n    const {\n      getFieldDecorator\n    } = this.props.form;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(_Card, {\n        title: /*#__PURE__*/_jsxDEV(_Button, {\n          type: \"primary\",\n          onClick: () => {\n            this.showAdd();\n          },\n          children: [/*#__PURE__*/_jsxDEV(_Icon, {\n            type: \"plus\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 19\n          }, this), \"\\u65B0\\u589E\\u89D2\\u8272\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 18\n        }, this),\n        style: {\n          width: '100% '\n        },\n        children: /*#__PURE__*/_jsxDEV(_Table, {\n          dataSource: dataSource,\n          columns: columns,\n          bordered: true,\n          pagination: {\n            defaultPageSize: 5\n          },\n          rowKey: \"_id\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u65B0\\u589E\\u89D2\\u8272\",\n        visible: this.state.isShowAdd,\n        onOk: this.handleOk,\n        onCancel: this.handleCancel,\n        okText: \"\\u786E\\u8BA4\",\n        cancelText: \"\\u53D6\\u6D88\",\n        children: /*#__PURE__*/_jsxDEV(_Form, {\n          onSubmit: this.handleOk,\n          children: /*#__PURE__*/_jsxDEV(Item, {\n            children: getFieldDecorator('roleName', {\n              initialValue: '',\n              rules: [{\n                required: true,\n                message: '角色名必须输入'\n              }]\n            })( /*#__PURE__*/_jsxDEV(_Input, {\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u89D2\\u8272\\u540D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 172,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u8BBE\\u7F6E\\u6743\\u9650\",\n        visible: this.state.isShowAuth,\n        onOk: this.handleAuthOk,\n        onCancel: this.handleAuthCancel,\n        okText: \"\\u786E\\u8BA4\",\n        cancelText: \"\\u53D6\\u6D88\",\n        children: /*#__PURE__*/_jsxDEV(_Tree, {\n          checkable: true //允许选中\n          ,\n          onCheck: this.onCheck,\n          checkedKeys: this.state.checkedKeys,\n          defaultExpandAll: true,\n          children: /*#__PURE__*/_jsxDEV(TreeNode, {\n            title: \"\\u5E73\\u53F0\\u529F\\u80FD\",\n            children: this.renderTreeNodes(treeData)\n          }, 'top', false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this);\n  }\n\n}, _temp)) || _class);\nexport default Role;","map":{"version":3,"sources":["C:/Users/PC/Desktop/react-project/src/containers/Role/index.jsx"],"names":["React","Component","dayjs","reqRoleList","reqAddRole","reqAuthRole","menuList","connect","Item","TreeNode","Role","state","username","userInfo","user","isShowAdd","isShowAuth","roleList","checkedKeys","_id","getRoleList","result","status","data","setState","handleOk","props","form","validateFields","err","values","msg","success","error","handleCancel","handleAuthOk","menus","auth_name","handleAuthCancel","onCheck","showAuth","id","find","item","showAdd","resetFields","renderTreeNodes","map","children","title","key","componentDidMount","render","dataSource","columns","dataIndex","time","format","treeData","getFieldDecorator","width","defaultPageSize","initialValue","rules","required","message"],"mappings":"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","sourcesContent":["import React,{Component} from 'react'\r\nimport {Card,Button,Icon,Table, message,Modal,Form,Input,Tree } from 'antd';\r\nimport dayjs from 'dayjs'\r\nimport {reqRoleList,reqAddRole,reqAuthRole} from '../../api'\r\nimport menuList from '../../config/menu_config'\r\nimport {connect} from 'react-redux'\r\nconst {Item} = Form\r\nconst {TreeNode} = Tree;\r\n\r\n@connect(\r\n  state => ({username:state.userInfo.user.username}),\r\n  {}\r\n)\r\nclass Role extends Component{\r\n\r\n  state = {\r\n    isShowAdd:false,\r\n    isShowAuth:false,\r\n    roleList:[],\r\n    menuList,\r\n    checkedKeys: [],//选中的菜单\r\n    _id:''//当前操作的角色id\r\n  }\r\n\r\n  getRoleList = async()=>{\r\n    let result = await reqRoleList()\r\n    const {status,data} = result\r\n    if(status===0) this.setState({roleList:data})\r\n  }\r\n\r\n  componentDidMount(){\r\n    this.getRoleList()\r\n  }\r\n\r\n  //新增角色--确认按钮\r\n  handleOk = ()=>{\r\n    this.props.form.validateFields(async(err, values) => {\r\n      if(err) return\r\n      let result = await reqAddRole(values)\r\n      const {status,msg} = result\r\n      if(status===0) {\r\n        message.success('新增角色成功')\r\n        this.getRoleList()\r\n        this.setState({isShowAdd:false})\r\n      }\r\n      else message.error(msg)\r\n    });\r\n  }\r\n\r\n  //新增角色--取消按钮\r\n  handleCancel = ()=>{\r\n    this.setState({isShowAdd:false})\r\n  }\r\n\r\n  //授权弹窗--确认按钮\r\n  handleAuthOk = async()=>{\r\n    const {_id,checkedKeys} = this.state\r\n    const {username} = this.props\r\n    let result = await reqAuthRole({_id,menus:checkedKeys,auth_name:username})\r\n    const {status,data,msg} = result\r\n    if(status===0) {\r\n      message.success('授权成功',1)\r\n      this.setState({isShowAuth:false})\r\n      this.getRoleList()\r\n    }\r\n    else message.error(msg,1)\r\n  }\r\n\r\n  //授权弹窗--取消按钮\r\n  handleAuthCancel = ()=>{\r\n    this.setState({isShowAuth:false})\r\n  }\r\n\r\n  onCheck = checkedKeys => this.setState({ checkedKeys });\r\n\r\n  //用于展示授权弹窗\r\n  showAuth = (id)=>{\r\n    const {roleList} = this.state\r\n    let result = roleList.find((item)=>{\r\n      return item._id === id\r\n    })\r\n    if(result) this.setState({checkedKeys:result.menus})\r\n    this.setState({isShowAuth:true,_id:id})\r\n  }\r\n\r\n  //用于展示新增弹窗\r\n  showAdd = ()=>{\r\n    this.props.form.resetFields()\r\n    this.setState({isShowAdd:true});\r\n  }\r\n\r\n  renderTreeNodes = (data) =>\r\n      data.map(item => {\r\n      if (item.children) {\r\n        return (\r\n          <TreeNode title={item.title} key={item.key} dataRef={item}>\r\n            {this.renderTreeNodes(item.children)}\r\n          </TreeNode>\r\n        );\r\n      }\r\n      return <TreeNode key={item.key} {...item} />;\r\n  });\r\n\r\n  render(){\r\n    const dataSource = this.state.roleList\r\n    const columns = [\r\n      {\r\n        title: '角色名称',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n      },\r\n      {\r\n        title: '创建时间',\r\n        dataIndex: 'create_time',\r\n        key: 'create_time',\r\n        render:(time)=> dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss')\r\n      },\r\n      {\r\n        title: '授权时间',\r\n        dataIndex: 'auth_time',\r\n        key: 'auth_time',\r\n        render:(time)=> time ? dayjs(time).format('YYYY年 MM月DD日 HH:mm:ss') : ''\r\n      },\r\n      {\r\n        title: '授权人',\r\n        dataIndex: 'auth_name',\r\n        key: 'auth_name',\r\n      },\r\n      {\r\n        title: '操作',\r\n        key: 'option',\r\n        render: (item) => <Button type='link' onClick={()=>{this.showAuth(item._id)}}>设置权限</Button>\r\n      }\r\n    ];\r\n    //treeData是属性菜单的源数据\r\n    const treeData = this.state.menuList\r\n    const {getFieldDecorator} = this.props.form\r\n    return (\r\n      <div>\r\n        <Card\r\n          title={<Button type='primary' onClick={()=>{this.showAdd()}}>\r\n                  <Icon type=\"plus\"/>\r\n                  新增角色\r\n                 </Button>}\r\n          style={{ width: '100% '}}\r\n        >\r\n          <Table \r\n            dataSource={dataSource} \r\n            columns={columns}\r\n            bordered\r\n            pagination={{defaultPageSize:5}}\r\n            rowKey=\"_id\"\r\n          />\r\n        </Card>\r\n        {/* 新增角色提示框 */}\r\n        <Modal\r\n          title=\"新增角色\"\r\n          visible={this.state.isShowAdd}\r\n          onOk={this.handleOk}\r\n          onCancel={this.handleCancel}\r\n          okText=\"确认\"\r\n          cancelText=\"取消\"\r\n        >\r\n          <Form onSubmit={this.handleOk}>\r\n            <Item>\r\n              {getFieldDecorator('roleName', {\r\n                initialValue:'',\r\n                rules: [\r\n                  {required: true, message: '角色名必须输入' },\r\n                ],\r\n              })(\r\n                <Input placeholder=\"请输入角色名\" />\r\n              )}\r\n            </Item>\r\n          </Form>\r\n        </Modal>\r\n        {/* 设置权限提示框 */}\r\n        <Modal\r\n          title=\"设置权限\"\r\n          visible={this.state.isShowAuth}\r\n          onOk={this.handleAuthOk}\r\n          onCancel={this.handleAuthCancel}\r\n          okText=\"确认\"\r\n          cancelText=\"取消\"\r\n        >\r\n          <Tree\r\n            checkable //允许选中\r\n            onCheck={this.onCheck}\r\n            checkedKeys={this.state.checkedKeys}\r\n            defaultExpandAll={true}\r\n          >\r\n            <TreeNode title='平台功能' key='top'>\r\n              {this.renderTreeNodes(treeData)}\r\n            </TreeNode>\r\n          </Tree>\r\n        </Modal>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Role"]},"metadata":{},"sourceType":"module"}